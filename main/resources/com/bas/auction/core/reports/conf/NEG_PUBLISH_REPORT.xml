<?xml version="1.0" encoding="UTF-8"?>
<sql>
    <sqlStatement name="NEG_HEADER">
        <![CDATA[
Select Nh.Neg_Type
      ,UPPER(Lv1.Meaning) Neg_Type_Meaning
      ,Nh.Doc_Number
      ,C.Name_Ru Organizator_Name
      ,Min_Bid_Limit_Days
      ,Nh.Title
      ,To_Char(Nh.Open_Date, 'DD.MM.YYYY HH24:MI:SS') Open_Date
      ,To_Char(Nh.Close_Date, 'DD.MM.YYYY HH24:MI:SS') Close_Date
      ,(SELECT phone_number FROM auction.addresses WHERE customer_id = nh.customer_id ORDER BY address_type DESC LIMIT 1) Phone
      ,(Select U.Full_Name
          From Auction.Users_v u
         Where U.User_Id = ?) Preparer
      ,ROUND(Nh.auction_bid_step,2) auction_bid_step
      ,Nh.auction_bid_step_type
      ,Cs.auction_ext_number
      ,Cs.auction_ext_duration
      ,Cs.auction_ext_time_left
  From Auction.Pd_Neg_Header Nh
  Join Auction.Lookup_Values Lv1
    On Lv1.Lookup_Code = Nh.Neg_Type
   And Lv1.Lookup_Type = 'PURCHASE_METHOD'
   And Lv1.Language = 'RU'
  Join Auction.Customers c
    On C.Customer_Id = Nh.Customer_Id
  Join Auction.Customer_Settings Cs
    On Cs.setting_id = Nh.setting_id
 Where Nh.Neg_Id = ?]]>
    </sqlStatement>
    <sqlStatement name="NEG_LINES">
        <![CDATA[
Select Nl.Line_Num
      ,Nl.Item_Name_Ru
      ,Nl.Item_Short_Desc_Ru
      ,Nl.Item_Long_Desc_Ru
      ,Nl.Quantity
      ,U.Measure Uom
      ,Nl.Amount_Without_Vat
      ,Nl.Incoterms2010
      ,Nl.Shipping_Location
      ,Nl.Shipping_Date
  From Auction.Pd_Neg_Lines Nl
  Join md.uom_codes u
    On U.Code = Nl.Uom_Code
 Where Nl.Neg_Id = ?
 Order By Nl.Line_Num]]>
    </sqlStatement>
    <sqlStatement name="DOCUMENTS">
        <![CDATA[
Select F.File_Name, L.Meaning File_Type
  From Auction.Pd_Neg_Header Nh
  Join Auction.File_Attributes Fa
    On Fa.Value = Nh.Neg_Id::Text
   And Fa.Name = 'neg_id'
  Left Join Auction.File_Attributes Fa2
    On Fa2.Name = 'file_type'
   And Fa2.File_Id = Fa.File_Id
  Left Join Auction.Lookup_Values l
    On Fa2.Value = L.Lookup_Code
   And L.Lookup_Type = (Case Nh.Neg_Type
         When 'RFQ' Then
          'NEG_HDR_DOCS_RFQ'
         When 'AUCTION' Then
          'NEG_HDR_DOCS_AUCTION'
         When 'TENDER' Then
          'NEG_HDR_DOCS_TENDER'
         When 'TENDER2' Then
          'NEG_HDR_DOCS_TENDER2'
       End)
   And L.Language = 'RU'
  Join Auction.Files f
    On Fa.File_Id = F.File_Id
 Where Nh.Neg_Id = ?]]>
    </sqlStatement>
</sql>